---
# tasks file for image_build
- name: Build the postgresql image
  docker_image:
    name: postgres:9.6-alpine
  notify: clean images

- name: Stage the requirements file for the limited recommender image
  copy:
    src: ../requirements/requirements.txt
    dest: "{{ role_path }}/files"
  notify: unstage

- name: Stage the source code for the limited recommender image
  synchronize:
    src: ../recommendersystem/web
    dest: "{{ role_path }}/files"
  notify: unstage

- name: Build the limited recommender system image
  docker_image:
    name: limited_recommender
    path: "{{ role_path }}/files"
    dockerfile: Dockerfile
    force: yes
  notify: clean images

- name: Build the limited recommender system task image
  docker_image:
    name: limited_recommender_task
    path: "{{ role_path }}/files"
    dockerfile: Dockerfile.task
    force: yes
    pull: no
  notify: clean images
